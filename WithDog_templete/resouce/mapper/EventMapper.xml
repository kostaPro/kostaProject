<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="store.mapper.EventMapper">

	<resultMap type="Event" id="EventMap">
		<result property="eventId" column="EVENTID" />
		<result property="eventName" column="EVENTNAME" />
		<result property="eventImage" column="EVENTIMAGE" />
		<result property="openDate" column="OPENDATE" />
		<result property="closeDate" column="CLOSEDATE" />
		<result property="eventInfo" column="EVENTINFO" />
		
		<association property="eventSpot" column="SPOTID"
			select="store.mapper.SpotMapper.retrieveSpotBySpotId" javaType="Spot"
			jdbcType="NUMERIC" />
	</resultMap>


	<sql id="selectEvent">
		select eventId, eventName, eventSpotId, eventImage,
		openDate, closeDate, eventInfo
		from event_tb
	</sql>

	<insert id="createEvent" parameterType="Event">
		<selectKey keyProperty="eventId" resultType="integer" order="BEFORE">
			SELECT event_seq.nextval FROM dual
		</selectKey>
		INSERT INTO
		EVENT_TB(EVENTID, EVENTNAME, EVENTSPOTID, EVENTIMAGE,
		OPENDATE,
		CLOSEDATE, EVENTINFO)
		VALUES (#{eventId}, #{eventName},
		#{eventSpot.spotId},
		#{eventImage}, #{openDate}, #{closeDate},
		#{eventInfo})
	</insert>

	<select id="retrieveAllEvents" resultType="Event">
		<include refid="selectEvent"></include>
	</select>


	<select id="retrieveEventsByLocation" parameterType="String" resultType="Event">
		SELECT eventId, eventName, eventSpotId, eventImage,
		openDate, closeDate, eventInfo
		FROM event_tb INNER JOIN spot_tb
		ON
		event_tb.eventSpotId = spot_tb.spotId
		WHERE spot_tb.spotLocation like
		#{location}
	</select>


	<select id="retrieveEventByEventId" parameterType="integer" resultMap="EventMap">
		<include refid="selectEvent"></include>
		WHERE EVENTID = #{eventId}
	</select>
	
	<update id="updateEvent" parameterType="Event">
		UPDATE event_tb
		SET
		OPENDATE = #{openDate}, CLOSEDATE = #{closeDate}, EVENTSPOTID = #{eventSpot.spotId}, EVENTINFO = #{eventInfo}
		WHERE EVENTID = #{eventId}
	</update>
	
	<delete id="deleteEvent" parameterType="integer">
		DELETE FROM event_tb
		WHERE EVENTID = #{eventId}
	</delete>





</mapper>