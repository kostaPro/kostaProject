<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="store.mapper.EventMapper">

	<resultMap type="Event" id="eventMap">
	<result property="eventId" column="EVENTID"/>
	<result property="eventName" column="EVENTNAME"/>
	<result property="eventSpot" column="EVENTSPOTID"/>
	<result property="eventImage" column="EVENTIMAGE"/>
	<result property="openDate" column="OPENDATE"/>
	<result property="closeDate" column="CLOSEDATE"/>
	<result property="eventInfo" column="EVENTINFO"/>
	</resultMap>

	<sql id="selectEvent">
		select eventId, eventName, eventSpotId, eventImage,
		openDate, closeDate, eventInfo
		from event_tb
	</sql>

	<insert id="createEvent" parameterType="Event">
		<selectKey keyProperty="eventId" resultType="integer" order="BEFORE">
			SELECT event_seq.nextval FROM dual
		</selectKey>
		INSERT INTO
		EVENT_TB(EVENTID, EVENTNAME, EVENTSPOTID, EVENTIMAGE, OPENDATE,
		CLOSEDATE, EVENTINFO)
		VALUES (#{eventId, #{eventName}, #{eventSpot},
		#{eventImage}, #{openDate}, #{closeDate}, #{eventInfo})
	</insert>

	<select id="retrieveAllEvents" resultType="Event">
		<include refid="selectEvent"></include>
	</select>

	<select id="retrieveEventsByDate" parameterType="Date" resultType="Event">
		<include refid="selectEvent"></include>
		WHERE OPENDATE = #{openDate} and CLOSEDATE = #{closeDate}
	</select>

	<select id="retrieveEventsByLocation" parameterType="String" resultType="Event">
		select eventId, eventName, eventSpotId, eventImage,
		openDate, closeDate, eventInfo
		from event_tb JOIN spot_tb
		on event_tb.eventSpotId = spot_tb.spotId
		where spot_tb.spotLocation like #{location} 
	</select>

	<select id="retrieveEventsByDateLocation" parameterType="Map" resultType="Event">
		select eventId, eventName, eventSpotId, eventImage,
		openDate, closeDate, eventInfo
		from event_tb JOIN spot_tb
		on event_tb.eventSpotId = spot_tb.spotId
		WHERE OPENDATE = #{openDate} and CLOSEDATE = #{closeDate} 
		and spot_tb.spotLocation like #{location}
	</select>

	<select id="retrieveEventByEventId" parameterType="String" resultType="Event">
		<include refid="selectEvent"></include>
		WHERE EVENTID = #{eventId}
	</select>

	<select id="retrieveJoinListByEventDate" parameterType="Map" resultType="Event">//
		select guestId
		from joinEvent_tb
		WHERE JOINDATE = #{joinDate}
	</select>

	<insert id="joinEventMeeting" parameterType="Map">//
		insert into joinEvent_tb
		Set guestId, eventId, date
		where EVENTID = #{eventId}
		
	</insert>

	<select id="cancelEventMeeting" parameterType="Map">
		delete from joinEvent_tb
		WHERE guestId = #{guestId} and joinDate = #{joinDate}
	</select>

	<select id="cancelAllEventMeeting" parameterType="integer">
		delete from joinEvent_tb
		WHERE guestId = #{guestId}
	</select>

	<update id="updateEvent" parameterType="Event">
		UPDATE event_tb
		SET
		OPENDATE = #{openDate}, CLOSEDATE = #{closeDate}, EVENTSPOTID = #{eventSpot}, EVENTINFO = #{eventInfo}
		WHERE EVENTID = #{eventId}
	</update>

	<delete id="deleteEvent" parameterType="integer">
		DELETE FROM event_tb
		WHERE EVENTID = #{eventId}
	</delete>












</mapper>